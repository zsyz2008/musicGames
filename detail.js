!function(g){var o={};function e(p){if(o[p])return o[p].exports;var m=o[p]={i:p,l:!1,exports:{}};return g[p].call(m.exports,m,m.exports,e),m.l=!0,m.exports}e.m=g,e.c=o,e.d=function(g,o,p){e.o(g,o)||Object.defineProperty(g,o,{enumerable:!0,get:p})},e.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},e.t=function(g,o){if(1&o&&(g=e(g)),8&o)return g;if(4&o&&"object"==typeof g&&g&&g.__esModule)return g;var p=Object.create(null);if(e.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:g}),2&o&&"string"!=typeof g)for(var m in g)e.d(p,m,function(o){return g[o]}.bind(null,m));return p},e.n=function(g){var o=g&&g.__esModule?function(){return g.default}:function(){return g};return e.d(o,"a",o),o},e.o=function(g,o){return Object.prototype.hasOwnProperty.call(g,o)},e.p="",e(e.s=1)}([,function(g,o,e){const p=["#e05915","#cdd422","#431c5d","#bccbde","#3cc47c","#431c5d","#3cc47c","#76323f","#cdd422","#431c5d","#bccbde","#c2dde6"],m={flute:"flute",piano:"piano","lead 1 (square)":"flute","electric bass (finger)":"bass-electric","fretless bass":"bass-electric","lead 2 (sawtooth)":"flute","overdriven guitar":"guitar-electric","string ensemble 1":"violin","orchestral harp":"harp","acoustic grand piano":"piano",vibraphone:"piano",trumpet:"trumpet","acoustic guitar (steel)":"guitar-acoustic","electric guitar (clean)":"guitar-electric","soprano sax":"saxophone","pad 2 (warm)":"violin","alto sax":"saxophone","electric guitar (jazz)":"guitar-electric","acoustic bass":"piano","synth bass 1":"bass-electric","drawbar organ":"organ",piccolo:"flute",shamisen:"guitar-acoustic",xylophone:"xylophone","drawbar organ":"organ",shakuhachi:"clarinet","church organ":"organ",cello:"cello",harmonica:"harmonium",trombone:"trombone","muted trumpet":"trumpet",glockenspiel:"xylophone","bag pipe":"flute","pan flute":"flute",recorder:"organ",clarinet:"clarinet",whistle:"saxophone",accordion:"harmonium","string ensemble 2":"violin","slap bass 1":"bass-electric","electric piano 2":"piano",tuba:"tuba",oboe:"clarinet","english horn":"bassoon","french horn":"french-horn",bassoon:"bassoon","synthstrings 1":"violin","pizzicato strings":"harp",contrabass:"contrabass"},t={"bass-electric":{"A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},"bass-acoustic":{"A#1":"Bb1.[mp3|ogg]","A#2":"Bb2.[mp3|ogg]","A#3":"Bb3.[mp3|ogg]","A#4":"Bb4.[mp3|ogg]","C#1":"Db1.[mp3|ogg]","C#2":"Db2.[mp3|ogg]","C#3":"Db3.[mp3|ogg]","C#4":"Db4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},bassoon:{A4:"A4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",E4:"E4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]"},cello:{E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]"},clarinet:{D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]",D3:"D3.[mp3|ogg]"},contrabass:{C2:"C2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]",D2:"D2.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]",G1:"G1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]",A2:"A2.[mp3|ogg]","A#1":"As1.[mp3|ogg]",B3:"B3.[mp3|ogg]"},flute:{A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]"},"french-horn":{D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F5:"F5.[mp3|ogg]",G2:"G2.[mp3|ogg]",A1:"A1.[mp3|ogg]",A3:"A3.[mp3|ogg]",C2:"C2.[mp3|ogg]",C4:"C4.[mp3|ogg]"},"guitar-acoustic":{F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds3.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]"},"guitar-electric":{"D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]",E2:"E2.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]"},"guitar-nylon":{"F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G3.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#5":"As5.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]"},harmonium:{C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]"},harp:{C5:"C5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D4:"D4.[mp3|ogg]",D6:"D6.[mp3|ogg]",D7:"D7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E3:"E3.[mp3|ogg]",E5:"E5.[mp3|ogg]",F2:"F2.[mp3|ogg]",F4:"F4.[mp3|ogg]",F6:"F6.[mp3|ogg]",F7:"F7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A4:"A4.[mp3|ogg]",A6:"A6.[mp3|ogg]",B1:"B1.[mp3|ogg]",B3:"B3.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C3:"C3.[mp3|ogg]"},organ:{C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]"},piano:{A7:"A7.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]","A#7":"As7.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]","A#6":"As6.[mp3|ogg]",B7:"B7.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C7:"C7.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#7":"Cs7.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]","C#6":"Cs6.[mp3|ogg]",D7:"D7.[mp3|ogg]",D1:"D1.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]","D#7":"Ds7.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","D#6":"Ds6.[mp3|ogg]",E7:"E7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",F7:"F7.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",F6:"F6.[mp3|ogg]","F#7":"Fs7.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]",G7:"G7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]","G#7":"Gs7.[mp3|ogg]","G#1":"Gs1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]","G#6":"Gs6.[mp3|ogg]"},saxophone:{"D#5":"Ds5.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]"},trombone:{"A#3":"As3.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]"},trumpet:{C6:"C6.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",G4:"G4.[mp3|ogg]",A3:"A3.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#4":"As4.[mp3|ogg]",C4:"C4.[mp3|ogg]"},tuba:{"A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]","A#1":"As1.[mp3|ogg]"},violin:{A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]"},xylophone:{C8:"C8.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]",G7:"G7.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]"}},n=new Staff({id:"myStaff",at:"staffDiv",clef:"grand",accidental:"flat",color:"#000",scroll:!1});n.setClef("grand");const s=new Tone.Chorus(4,2.5,.5).toDestination().start();synth1=(new Tone.PolySynth).connect(s);const r=new Tone.Distortion(.8).toDestination();synth2=(new Tone.FMSynth).connect(r),synth3=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();let a;a="//cdn.jsdelivr.net/gh/zsyz2008/musicGames/song/"+function(g){for(var o=window.location.search.substring(1).split("&"),e=0;e<o.length;e++){var p=o[e].split("=");if(p[0]==g)return p[1]}return!1}("name")+".json";const i=document.getElementById("scoreGroup");let c;function l(g){return new Promise((o,e)=>{let p;p="https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/"+g+"/";const m=new Tone.Sampler({urls:t[g],baseUrl:p,onload:g=>{o(m)}}).toDestination()})}fetch(a).then(g=>{if(200===g.status)return g.json();console.log("Looks like there was a problem. Status Code: "+g.status)}).then((function(g){c=g,document.getElementById("title").textContent=c.header.name;const o=c.header.timeSignatures[0].timeSignature[0],e=document.getElementById("scorePai");for(let g=0;g<o;g++){const p=document.createElement("div");p.boxSizing="content-box",p.setAttribute("class","list"),p.style.backgroundColor="#fff",g<o-1&&(p.style.borderRight="1px solid #db5a6b"),p.style.width=100/o+"%",p.textContent="第"+(g+1)+"拍",e.appendChild(p)}return p=c,new Promise((g,o)=>{const e=+p.header.tempos[0].bpm,t=4*+p.header.timeSignatures[0].timeSignature[0]/+p.header.timeSignatures[0].timeSignature[1]*(60/e),n={};let s=p.tracks;s=s.filter(g=>g.notes.length>0),s=s.filter(g=>"standard kit"!==g.instrument.name),s=s.filter(g=>"jazz kit"!==g.instrument.name);const r=s.find(g=>-1!==g.instrument.name.indexOf(" bass"));s=s.filter(g=>-1===g.instrument.name.indexOf(" bass")),r&&s.push(r);const a=[];for(let g of s){const o=g.instrument.name;let e;m[o]?e=l(m[o]):(console.log(o),e=Promise.resolve(synth1)),a.push(e)}Promise.all(a).then(g=>g).then(o=>{s.forEach((g,e)=>{const p=o[e];g.notes.forEach(o=>{const m=o.time;let t,r=n[m];t=0===e?"solo":e===s.length-1&&-1!==g.instrument.name.indexOf(" bass")?"bass":"zt";const a={type:t,name:o.name,duration:o.duration,velocity:+o.velocity*{solo:1,bass:1,zt:.4}[t],synth:p,trackIndex:e};r?r.push(a):n[m]=[a]})});const e=[];let p=[],m=Object.keys(n).sort((function(g,o){return+g-+o}));for(let g of m)e.push(n[g]),p.push(g);const r=Math.ceil(p[p.length-1]/t),a={},i={},c={};for(let g=0;g<r;g++){const o=[];for(let e=0;e<p.length;e++)p[e]<(g+1)*t&&p[e]>=g*t&&(o.push({index:e,duration:p[e+1]-p[e]||1}),c[e]=o[0].index);const e=o[0]||"none";a[e.index]=o,i[e.index]=g}const l=s.length;g({notes:e,times:p,groupMap:a,groupValMap:i,trackLen:l,indexToGroupMap:c})})});var p})).then(g=>{!function(g){const{playBtn:o,scoreContainer:e,mid:m}=g,{notes:t,times:s,groupMap:r,groupValMap:a,indexToGroupMap:c,trackLen:l}=m;let C,u=0,A=0,d=!1;document.getElementById("control").addEventListener("change",(function(g){d=!!g.target.checked}));const D=document.getElementById("staff"),G=document.getElementById("staffDiv");D.addEventListener("change",(function(g){g.target.checked?G.style.visibility="visible":G.style.visibility="hidden"}));function F(){A++;const g=r[u];if(g){i.textContent="第"+(+a[u]+1)+"小节",C=[],e.innerHTML="",A=0;const o=g.reduce((g,o)=>g+o.duration,0);for(let m=0;m<g.length;m++){const n=document.createElement("div"),s=g[m];n.setAttribute("class","list"),n.style.width=100*s.duration/o+"%";const r=t[s.index];for(let g=0;g<l;g++){const o=document.createElement("div");o.setAttribute("class","avatar");const e=100/l;o.style.height=e+"%",o.style.top=e*g+"%";r[g];const m=r.filter(o=>o.trackIndex===g);for(let e=m.length-1;e>=0;e--){const t=m[e],n=document.createElement("div");n.setAttribute("class","fq"),n.style.height=100/m.length+"%",n.style.backgroundColor=p[g]||"#000",n.style.opacity=t.velocity,n.addEventListener("touchstart",g=>{y(t),g.preventDefault()}),o.appendChild(n)}n.appendChild(o)}e.appendChild(n),C.push(n)}}}if(document.getElementById("reset").addEventListener("click",()=>{u=c[u-1],A=0,F()}),F(),o.style.visibility="visible",o.addEventListener("touchstart",g=>{x(),g.preventDefault()}),o.addEventListener("touchend",g=>{b()}),o.addEventListener("mousedown",g=>{x(),g.preventDefault()}),o.addEventListener("mouseup",g=>{b()}),window.addEventListener("keydown",g=>{x()}),window.addEventListener("keyup",g=>{b()}),!navigator.requestMIDIAccess)return void alert("当前浏览器不支持 MIDI 连接，请使用 Chrome 等支持 Web MIDI 的浏览器");let h=[];const f=g=>{const o=`${g.note.name}${g.note.accidental?g.note.accidental:""}${g.note.octave}`;h.push(Tone.Frequency(o).toMidi());const e=t[u].map(g=>Tone.Frequency(g.name).toMidi());let p=!0;for(let g of e)h.includes(g)||(p=!1);p&&x()},E=()=>{h=[]};function b(){d&&B&&B.forEach(g=>{g.synth.triggerRelease(g.name)})}function y(g){d?g.synth.triggerAttack(g.name,Tone.now(),g.velocity):g.synth.triggerAttackRelease(g.name,g.duration,Tone.now(),g.velocity)}WebMidi.enable(()=>{if(0===WebMidi.inputs.length)return void console.log("没有找到可连接的 MIDI 设备，请检查 MIDI 设备是否正确连接");const g=WebMidi.inputs[0];g.addListener("noteon","all",f),g.addListener("noteoff","all",E)});let B,v;function x(){b();const g=t[u+1];if(g){const o=g.map(g=>Tone.Frequency(g.name).toMidi());n.setNotes(o)}const o=t[u];B=o,o.forEach(g=>{y(g)}),function(){if(C&&C[A])for(let g of Array.prototype.slice.call(C[A].children))g.style.width="0%";F(),clearInterval(v);const g=C[A];if(!g)return;const o=s[u],e=s[u+1];let p;p=e?1e3*(e-o):3e3;let m,n=Date.now();v=setInterval(()=>{if(m<=0){t[u];clearInterval(v),m=0;for(let o of Array.prototype.slice.call(g.children))o.style.width="0%";return void(g.style.borderRight="1px dashed #db5a6b")}m=p-(Date.now()-n);const o=Math.ceil(100*m/p);for(let e of Array.prototype.slice.call(g.children))e.style.width=o+"%"},30)}(),u===t.length-1?u=0:u++}}({playBtn:document.getElementById("playBtn"),scoreContainer:document.getElementById("scoreContainer"),mid:g})}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);