!function(g){var o={};function p(e){if(o[e])return o[e].exports;var m=o[e]={i:e,l:!1,exports:{}};return g[e].call(m.exports,m,m.exports,p),m.l=!0,m.exports}p.m=g,p.c=o,p.d=function(g,o,e){p.o(g,o)||Object.defineProperty(g,o,{enumerable:!0,get:e})},p.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},p.t=function(g,o){if(1&o&&(g=p(g)),8&o)return g;if(4&o&&"object"==typeof g&&g&&g.__esModule)return g;var e=Object.create(null);if(p.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:g}),2&o&&"string"!=typeof g)for(var m in g)p.d(e,m,function(o){return g[o]}.bind(null,m));return e},p.n=function(g){var o=g&&g.__esModule?function(){return g.default}:function(){return g};return p.d(o,"a",o),o},p.o=function(g,o){return Object.prototype.hasOwnProperty.call(g,o)},p.p="",p(p.s=1)}([,function(g,o,p){const e=["#e05915","#cdd422","#431c5d","#bccbde","#3cc47c","#431c5d","#3cc47c","#76323f","#cdd422","#431c5d","#bccbde","#c2dde6"],m={flute:"flute",piano:"piano","lead 1 (square)":"flute","electric bass (finger)":"bass-electric","fretless bass":"bass-electric","lead 2 (sawtooth)":"flute","overdriven guitar":"guitar-electric","string ensemble 1":"violin","orchestral harp":"harp","acoustic grand piano":"piano",vibraphone:"piano",trumpet:"trumpet","acoustic guitar (steel)":"guitar-acoustic","electric guitar (clean)":"guitar-electric","soprano sax":"saxophone","pad 2 (warm)":"violin","alto sax":"saxophone","electric guitar (jazz)":"guitar-electric","acoustic bass":"piano","synth bass 1":"bass-electric","drawbar organ":"organ",piccolo:"flute",shamisen:"guitar-acoustic",xylophone:"xylophone","drawbar organ":"organ",shakuhachi:"clarinet","church organ":"organ",cello:"cello",harmonica:"harmonium",trombone:"trombone","muted trumpet":"trumpet",glockenspiel:"xylophone","bag pipe":"flute","pan flute":"flute",recorder:"organ",clarinet:"clarinet",whistle:"saxophone",accordion:"harmonium","string ensemble 2":"violin","slap bass 1":"bass-electric","electric piano 2":"piano",tuba:"tuba",oboe:"clarinet","english horn":"bassoon","french horn":"french-horn",bassoon:"bassoon","synthstrings 1":"violin","pizzicato strings":"harp",contrabass:"contrabass"},t={"bass-electric":{"A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},"bass-acoustic":{"A#1":"Bb1.[mp3|ogg]","A#2":"Bb2.[mp3|ogg]","A#3":"Bb3.[mp3|ogg]","A#4":"Bb4.[mp3|ogg]","C#1":"Db1.[mp3|ogg]","C#2":"Db2.[mp3|ogg]","C#3":"Db3.[mp3|ogg]","C#4":"Db4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},bassoon:{A4:"A4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",E4:"E4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]"},cello:{E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]"},clarinet:{D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]",D3:"D3.[mp3|ogg]"},contrabass:{C2:"C2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]",D2:"D2.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]",G1:"G1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]",A2:"A2.[mp3|ogg]","A#1":"As1.[mp3|ogg]",B3:"B3.[mp3|ogg]"},flute:{A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]"},"french-horn":{D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F5:"F5.[mp3|ogg]",G2:"G2.[mp3|ogg]",A1:"A1.[mp3|ogg]",A3:"A3.[mp3|ogg]",C2:"C2.[mp3|ogg]",C4:"C4.[mp3|ogg]"},"guitar-acoustic":{F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds3.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]"},"guitar-electric":{"D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]",E2:"E2.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]"},"guitar-nylon":{"F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G3.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#5":"As5.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]"},harmonium:{C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]"},harp:{C5:"C5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D4:"D4.[mp3|ogg]",D6:"D6.[mp3|ogg]",D7:"D7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E3:"E3.[mp3|ogg]",E5:"E5.[mp3|ogg]",F2:"F2.[mp3|ogg]",F4:"F4.[mp3|ogg]",F6:"F6.[mp3|ogg]",F7:"F7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A4:"A4.[mp3|ogg]",A6:"A6.[mp3|ogg]",B1:"B1.[mp3|ogg]",B3:"B3.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C3:"C3.[mp3|ogg]"},organ:{C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]"},piano:{A7:"A7.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]","A#7":"As7.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]","A#6":"As6.[mp3|ogg]",B7:"B7.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C7:"C7.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#7":"Cs7.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]","C#6":"Cs6.[mp3|ogg]",D7:"D7.[mp3|ogg]",D1:"D1.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]","D#7":"Ds7.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","D#6":"Ds6.[mp3|ogg]",E7:"E7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",F7:"F7.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",F6:"F6.[mp3|ogg]","F#7":"Fs7.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]",G7:"G7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]","G#7":"Gs7.[mp3|ogg]","G#1":"Gs1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]","G#6":"Gs6.[mp3|ogg]"},saxophone:{"D#5":"Ds5.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]"},trombone:{"A#3":"As3.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]"},trumpet:{C6:"C6.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",G4:"G4.[mp3|ogg]",A3:"A3.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#4":"As4.[mp3|ogg]",C4:"C4.[mp3|ogg]"},tuba:{"A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]","A#1":"As1.[mp3|ogg]"},violin:{A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]"},xylophone:{C8:"C8.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]",G7:"G7.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]"}},n=new Staff({id:"myStaff",at:"staffDiv",clef:"grand",accidental:"flat",color:"#000",scroll:!1});n.setClef("grand");const s=new Tone.Chorus(4,2.5,.5).toDestination().start();synth1=(new Tone.PolySynth).connect(s);const r=new Tone.Distortion(.8).toDestination();synth2=(new Tone.FMSynth).connect(r),synth3=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();let a;a="//cdn.jsdelivr.net/gh/zsyz2008/musicGames/song/"+function(g){for(var o=window.location.search.substring(1).split("&"),p=0;p<o.length;p++){var e=o[p].split("=");if(e[0]==g)return e[1]}return!1}("name")+".json";const i=document.getElementById("scoreGroup");let c;function l(g){return new Promise((o,p)=>{let e;e="https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/"+g+"/";const m=new Tone.Sampler({urls:t[g],baseUrl:e,onload:g=>{o(m)}}).toDestination()})}fetch(a).then(g=>{if(200===g.status)return g.json();console.log("Looks like there was a problem. Status Code: "+g.status)}).then((function(g){c=g,document.getElementById("title").textContent=c.header.name;const o=c.header.timeSignatures[0].timeSignature[0],p=document.getElementById("scorePai");for(let g=0;g<o;g++){const e=document.createElement("div");e.boxSizing="content-box",e.setAttribute("class","list"),e.style.backgroundColor="#fff",g<o-1&&(e.style.borderRight="1px solid #db5a6b"),e.style.width=100/o+"%",e.textContent="第"+(g+1)+"拍",p.appendChild(e)}return e=c,new Promise((g,o)=>{const p=60/+e.header.tempos[0].bpm*+e.header.timeSignatures[0].timeSignature[0],t={};let n=e.tracks;n=n.filter(g=>g.notes.length>0),n=n.filter(g=>"standard kit"!==g.instrument.name),n=n.filter(g=>"jazz kit"!==g.instrument.name);const s=n.find(g=>-1!==g.instrument.name.indexOf(" bass"));n=n.filter(g=>-1===g.instrument.name.indexOf(" bass")),s&&n.push(s);const r=[];for(let g of n){const o=g.instrument.name;let p;m[o]?p=l(m[o]):(console.log(o),p=Promise.resolve(synth1)),r.push(p)}Promise.all(r).then(g=>g).then(o=>{n.forEach((g,p)=>{const e=o[p];g.notes.forEach(o=>{const m=o.time;let s,r=t[m];s=0===p?"solo":p===n.length-1&&-1!==g.instrument.name.indexOf(" bass")?"bass":"zt";const a={type:s,name:o.name,duration:o.duration,velocity:+o.velocity*{solo:1,bass:1,zt:.4}[s],synth:e,trackIndex:p};r?r.push(a):t[m]=[a]})});const e=[];let m=[],s=Object.keys(t).sort((function(g,o){return+g-+o}));for(let g of s)e.push(t[g]),m.push(g);const r=Math.ceil(m[m.length-1]/p),a={},i={},c={};for(let g=0;g<r;g++){const o=[];for(let e=0;e<m.length;e++)m[e]<(g+1)*p&&m[e]>=g*p&&(o.push({index:e,duration:m[e+1]-m[e]||1}),c[e]=o[0].index);const e=o[0]||"none";a[e.index]=o,i[e.index]=g}const l=n.length;g({notes:e,times:m,groupMap:a,groupValMap:i,trackLen:l,indexToGroupMap:c})})});var e})).then(g=>{!function(g){const{playBtn:o,scoreContainer:p,mid:m}=g,{notes:t,times:s,groupMap:r,groupValMap:a,indexToGroupMap:c,trackLen:l}=m;let C,A=0,u=0,d=!1;function D(g){d=!!g.target.checked}document.getElementById("switch").addEventListener("change",D);const G=document.getElementById("staff"),F=document.getElementById("staffDiv");function D(g){g.target.checked?F.style.visibility="visible":F.style.visibility="hidden"}G.addEventListener("change",D);function h(){u++;const g=r[A];if(g){i.textContent="第"+(+a[A]+1)+"小节",C=[],p.innerHTML="",u=0;const o=g.reduce((g,o)=>g+o.duration,0);for(let m=0;m<g.length;m++){const n=document.createElement("div"),s=g[m];n.setAttribute("class","list"),n.style.width=100*s.duration/o+"%";const r=t[s.index];for(let g=0;g<l;g++){const o=document.createElement("div");o.setAttribute("class","avatar");const p=100/l;o.style.height=p+"%",o.style.top=p*g+"%";r[g];const m=r.filter(o=>o.trackIndex===g);for(let p=m.length-1;p>=0;p--){const t=m[p],n=document.createElement("div");n.setAttribute("class","fq"),n.style.height=100/m.length+"%",n.style.backgroundColor=e[g]||"#000",n.style.opacity=t.velocity,n.addEventListener("touchstart",g=>{y(t),g.preventDefault()}),o.appendChild(n)}n.appendChild(o)}p.appendChild(n),C.push(n)}}}if(document.getElementById("reset").addEventListener("click",()=>{A=c[A-1],u=0,h()}),h(),o.style.visibility="visible",o.addEventListener("touchstart",g=>{w(),g.preventDefault()}),o.addEventListener("touchend",g=>{b()}),o.addEventListener("mousedown",g=>{w(),g.preventDefault()}),o.addEventListener("mouseup",g=>{b()}),window.addEventListener("keydown",g=>{w()}),window.addEventListener("keyup",g=>{b()}),!navigator.requestMIDIAccess)return void alert("当前浏览器不支持 MIDI 连接，请使用 Chrome 等支持 Web MIDI 的浏览器");const f=()=>{w()},E=()=>{b()};function b(){d&&B&&B.forEach(g=>{g.synth.triggerRelease(g.name)})}function y(g){d?g.synth.triggerAttack(g.name,Tone.now(),g.velocity):g.synth.triggerAttackRelease(g.name,g.duration,Tone.now(),g.velocity)}WebMidi.enable(()=>{if(0===WebMidi.inputs.length)return void console.log("没有找到可连接的 MIDI 设备，请检查 MIDI 设备是否正确连接");const g=WebMidi.inputs[0];g.addListener("noteon","all",f),g.addListener("noteoff","all",E)});let B,v;function w(){b();const g=t[A];B=g;const o=g.map(g=>Tone.Frequency(g.name).toMidi());n.setNotes(o),g.forEach(g=>{y(g)}),function(){if(C&&C[u])for(let g of Array.prototype.slice.call(C[u].children))g.style.width="0%";h(),clearInterval(v);const g=C[u];if(!g)return;const o=s[A],p=s[A+1];let e;e=p?1e3*(p-o):3e3;let m,n=Date.now();v=setInterval(()=>{if(m<=0){t[A];clearInterval(v),m=0;for(let o of Array.prototype.slice.call(g.children))o.style.width="0%";return void(g.style.borderRight="1px dashed #db5a6b")}m=e-(Date.now()-n);const o=Math.ceil(100*m/e);for(let p of Array.prototype.slice.call(g.children))p.style.width=o+"%"},30)}(),A===t.length-1?A=0:A++}}({playBtn:document.getElementById("playBtn"),scoreContainer:document.getElementById("scoreContainer"),mid:g})}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);