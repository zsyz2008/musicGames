!function(g){var o={};function e(t){if(o[t])return o[t].exports;var p=o[t]={i:t,l:!1,exports:{}};return g[t].call(p.exports,p,p.exports,e),p.l=!0,p.exports}e.m=g,e.c=o,e.d=function(g,o,t){e.o(g,o)||Object.defineProperty(g,o,{enumerable:!0,get:t})},e.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},e.t=function(g,o){if(1&o&&(g=e(g)),8&o)return g;if(4&o&&"object"==typeof g&&g&&g.__esModule)return g;var t=Object.create(null);if(e.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:g}),2&o&&"string"!=typeof g)for(var p in g)e.d(t,p,function(o){return g[o]}.bind(null,p));return t},e.n=function(g){var o=g&&g.__esModule?function(){return g.default}:function(){return g};return e.d(o,"a",o),o},e.o=function(g,o){return Object.prototype.hasOwnProperty.call(g,o)},e.p="",e(e.s=1)}([,function(g,o,e){window.onerror=function(g,o,e){return alert(g),!1};const t=["#e05915","#cdd422","#431c5d","#bccbde","#3cc47c","#431c5d","#3cc47c","#76323f","#cdd422","#431c5d","#bccbde","#c2dde6"],p={flute:"flute",piano:"piano","lead 1 (square)":"flute","electric bass (finger)":"bass-electric","fretless bass":"bass-electric","lead 2 (sawtooth)":"flute","overdriven guitar":"guitar-electric","string ensemble 1":"violin","orchestral harp":"harp","acoustic grand piano":"piano",vibraphone:"piano",trumpet:"trumpet","acoustic guitar (steel)":"guitar-acoustic","electric guitar (clean)":"guitar-electric","soprano sax":"saxophone","pad 2 (warm)":"violin","alto sax":"saxophone","electric guitar (jazz)":"guitar-electric","acoustic bass":"bass-electric","synth bass 1":"bass-electric","drawbar organ":"organ",piccolo:"flute",shamisen:"guitar-acoustic",xylophone:"xylophone","drawbar organ":"organ",shakuhachi:"clarinet","church organ":"organ",cello:"cello",harmonica:"harmonium",trombone:"trombone","muted trumpet":"trumpet",glockenspiel:"xylophone","bag pipe":"flute","pan flute":"flute",recorder:"organ",clarinet:"clarinet",whistle:"saxophone",accordion:"harmonium","string ensemble 2":"violin","slap bass 1":"bass-electric","electric piano 2":"piano",tuba:"tuba",oboe:"clarinet","english horn":"bassoon","french horn":"french-horn",bassoon:"bassoon","synthstrings 1":"violin","pizzicato strings":"harp",contrabass:"contrabass","acoustic guitar (nylon)":"guitar-nylon"},m={"bass-electric":{"A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},"bass-acoustic":{"A#1":"Bb1.[mp3|ogg]","A#2":"Bb2.[mp3|ogg]","A#3":"Bb3.[mp3|ogg]","A#4":"Bb4.[mp3|ogg]","C#1":"Db1.[mp3|ogg]","C#2":"Db2.[mp3|ogg]","C#3":"Db3.[mp3|ogg]","C#4":"Db4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},bassoon:{A4:"A4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",E4:"E4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]"},cello:{E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]"},clarinet:{D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]",D3:"D3.[mp3|ogg]"},contrabass:{C2:"C2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]",D2:"D2.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]",G1:"G1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]",A2:"A2.[mp3|ogg]","A#1":"As1.[mp3|ogg]",B3:"B3.[mp3|ogg]"},flute:{A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]"},"french-horn":{D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F5:"F5.[mp3|ogg]",G2:"G2.[mp3|ogg]",A1:"A1.[mp3|ogg]",A3:"A3.[mp3|ogg]",C2:"C2.[mp3|ogg]",C4:"C4.[mp3|ogg]"},"guitar-acoustic":{F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds3.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]"},"guitar-electric":{"D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]",E2:"E2.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]"},"guitar-nylon":{"F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G3.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#5":"As5.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]"},harmonium:{C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]"},harp:{C5:"C5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D4:"D4.[mp3|ogg]",D6:"D6.[mp3|ogg]",D7:"D7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E3:"E3.[mp3|ogg]",E5:"E5.[mp3|ogg]",F2:"F2.[mp3|ogg]",F4:"F4.[mp3|ogg]",F6:"F6.[mp3|ogg]",F7:"F7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A4:"A4.[mp3|ogg]",A6:"A6.[mp3|ogg]",B1:"B1.[mp3|ogg]",B3:"B3.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C3:"C3.[mp3|ogg]"},organ:{C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]"},piano:{A7:"A7.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]","A#7":"As7.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]","A#6":"As6.[mp3|ogg]",B7:"B7.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C7:"C7.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#7":"Cs7.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]","C#6":"Cs6.[mp3|ogg]",D7:"D7.[mp3|ogg]",D1:"D1.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]","D#7":"Ds7.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","D#6":"Ds6.[mp3|ogg]",E7:"E7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",F7:"F7.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",F6:"F6.[mp3|ogg]","F#7":"Fs7.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]",G7:"G7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]","G#7":"Gs7.[mp3|ogg]","G#1":"Gs1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]","G#6":"Gs6.[mp3|ogg]"},saxophone:{"D#5":"Ds5.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]"},trombone:{"A#3":"As3.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]"},trumpet:{C6:"C6.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",G4:"G4.[mp3|ogg]",A3:"A3.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#4":"As4.[mp3|ogg]",C4:"C4.[mp3|ogg]"},tuba:{"A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]","A#1":"As1.[mp3|ogg]"},violin:{A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]"},xylophone:{C8:"C8.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]",G7:"G7.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]"}},n=new Staff({id:"myStaff",at:"staffDiv",clef:"grand",accidental:"flat",color:"#000",scroll:!1});n.setClef("grand");const s=new Tone.Chorus(4,2.5,.5).toDestination().start();synth1=(new Tone.PolySynth).connect(s);const r=new Tone.Distortion(.8).toDestination();synth2=(new Tone.FMSynth).connect(r),synth3=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();const a=A("name"),i=A("track");let c;c="//cdn.jsdelivr.net/gh/zsyz2008/musicGames/song/"+a+".json";const l=document.getElementById("scoreGroup");let u;function C(g){return new Promise((o,e)=>{let t;t="https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/"+g+"/";const p=new Tone.Sampler({urls:m[g],baseUrl:t,onload:g=>{o(p)}}).toDestination()})}function A(g){for(var o=window.location.search.substring(1).split("&"),e=0;e<o.length;e++){var t=o[e].split("=");if(t[0]==g)return t[1]}return!1}fetch(c).then(g=>{if(200===g.status)return g.json();console.log("Looks like there was a problem. Status Code: "+g.status)}).then((function(g){u=g,document.getElementById("title").textContent=u.header.name;const o=u.header.timeSignatures[0].timeSignature[0],e=document.getElementById("scorePai");for(let g=0;g<o;g++){const t=document.createElement("div");t.boxSizing="content-box",t.setAttribute("class","list"),t.style.backgroundColor="#fff",g<o-1&&(t.style.borderRight="1px solid #db5a6b"),t.style.width=100/o+"%",t.textContent="第"+(g+1)+"拍",e.appendChild(t)}return t=u,new Promise((g,o)=>{const e=+t.header.tempos[0].bpm,m=4*+t.header.timeSignatures[0].timeSignature[0]/(2*+t.header.timeSignatures[0].timeSignature[1])*(60/e),n={};let s=t.tracks;s=s.filter(g=>g.notes.length>0),s=s.filter(g=>"standard kit"!==g.instrument.name&&"jazz kit"!==g.instrument.name&&"brush kit"!==g.instrument.name);const r=s.find(g=>-1!==g.instrument.name.indexOf(" bass"));s=s.filter(g=>-1===g.instrument.name.indexOf(" bass")),r&&s.push(r),"solo"===i&&(s=s.filter((g,o)=>0===o)),"bz"===i&&(s=s.filter((g,o)=>0!==o));const a=[];for(let g of s){const o=g.instrument.name;let e;p[o]?e=C(p[o]):(console.log(o),e=Promise.resolve(synth1)),a.push(e)}Promise.all(a).then(g=>g).then(o=>{s.forEach((g,e)=>{const t=o[e];g.notes.forEach(o=>{const p=o.time;let m,r=n[p];m=0===e?"solo":e===s.length-1&&-1!==g.instrument.name.indexOf(" bass")?"bass":"zt";const a={type:m,name:o.name,duration:o.duration,velocity:+o.velocity*{solo:1,bass:1,zt:.4}[m],synth:t,trackIndex:e};r?r.push(a):n[p]=[a]})});const e=[];let t=[],p=Object.keys(n).sort((function(g,o){return+g-+o}));for(let g of p)e.push(n[g]),t.push(g);const r=Math.ceil(t[t.length-1]/m),a={},i={},c={};for(let g=0;g<r;g++){const o=[];for(let e=0;e<t.length;e++)t[e]<(g+1)*m&&t[e]>=g*m&&(o.push({index:e,duration:t[e+1]-t[e]||1}),c[e]=o[0].index);const e=o[0]||"none";a[e.index]=o,i[e.index]=g}const l=s.length;g({notes:e,times:t,groupMap:a,groupValMap:i,trackLen:l,indexToGroupMap:c})})});var t})).then(g=>{!function(g){const{playBtn:o,scoreContainer:e,mid:p}=g,{notes:m,times:s,groupMap:r,groupValMap:a,indexToGroupMap:i,trackLen:c}=p;let u,C=0,A=-1,D=!1;document.getElementById("control").addEventListener("change",(function(g){D=!!g.target.checked})),e.addEventListener("touchstart",g=>{g.preventDefault()});const d=document.getElementById("staff"),G=document.getElementById("staffDiv");d.addEventListener("change",(function(g){g.target.checked?G.style.visibility="visible":G.style.visibility="hidden"}));function F(){A++;const g=r[C];if(g){if(1===A)return void(A=0);l.textContent="第"+(+a[C]+1)+"小节",u=[],e.innerHTML="",A=0;const o=g.reduce((g,o)=>g+o.duration,0);for(let p=0;p<g.length;p++){const n=document.createElement("button"),s=g[p];n.setAttribute("class","list"),n.style.opacity=.4,n.style.width=100*s.duration/o+"%";const r=m[s.index];for(let g=0;g<c;g++){const o=document.createElement("div");o.setAttribute("class","avatar");const e=100/c;o.style.height=e+"%",o.style.top=e*g+"%";r[g];const m=r.filter(o=>o.trackIndex===g);for(let e=m.length-1;e>=0;e--){const p=m[e],n=document.createElement("div");n.setAttribute("class","fq"),n.style.height=100/m.length+"%",n.style.backgroundColor=t[g]||"#000",n.style.opacity=p.velocity,o.appendChild(n)}0===p&&B(n),n.appendChild(o)}if(p!==g.length-1){const g=document.createElement("div");g.setAttribute("class","list-border"),n.appendChild(g)}e.appendChild(n),u.push(n)}}}if(document.getElementById("reset").addEventListener("click",()=>{C=i[C-1],A=0,F()}),F(),window.addEventListener("keydown",g=>{w()}),window.addEventListener("keyup",g=>{y()}),!navigator.requestMIDIAccess)return void alert("当前浏览器不支持 MIDI 连接，请使用 Chrome 等支持 Web MIDI 的浏览器");let h=[];const f=g=>{const o=`${g.note.name}${g.note.accidental?g.note.accidental:""}${g.note.octave}`;h.push(Tone.Frequency(o).toMidi());const e=m[C].map(g=>Tone.Frequency(g.name).toMidi());let t=!0;for(let g of e)h.includes(g)||(t=!1);t&&w()},E=()=>{h=[]};function b(g){g&&g.preventDefault(),w()}function y(){var g;D&&v&&v.forEach(g=>{g.synth.triggerRelease(g.name)}),u&&u[A]&&(g=u[A])&&g.removeEventListener("touchstart",b)}function B(g){g&&(g.style.opacity=1,g.addEventListener("touchstart",b))}WebMidi.enable(()=>{if(0===WebMidi.inputs.length)return void console.log("没有找到可连接的 MIDI 设备，请检查 MIDI 设备是否正确连接");const g=WebMidi.inputs[0];g.addListener("noteon","all",f),g.addListener("noteoff","all",E)});let v,x;function w(){D&&v&&v.forEach(g=>{g.synth.triggerRelease(g.name)});const g=m[C+1];if(g){const o=g.map(g=>Tone.Frequency(g.name).toMidi());n.setNotes(o)}const o=m[C];v=o,o.forEach(g=>{!function(g){D?g.synth.triggerAttack(g.name,Tone.now(),g.velocity):g.synth.triggerAttackRelease(g.name,g.duration,Tone.now(),g.velocity)}(g)}),function(){F(),clearInterval(x);const g=u[A];if(!g)return;const o=s[C],e=s[C+1];let t;t=e?1e3*(e-o):3e3;let p,m=Date.now();x=setInterval(()=>{if(p<100)return clearInterval(x),p=0,g.style.opacity=0,B(u[A+1]),void(A===u.length-1&&(A=-1,F()));p=t-(Date.now()-m);const o=Math.ceil(100*p/t);g.style.opacity=o/100},10)}(),C===m.length-1?C=0:C++,y()}}({playBtn:document.getElementById("playBtn"),scoreContainer:document.getElementById("scoreContainer"),mid:g})}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);