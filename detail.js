!function(g){var o={};function e(p){if(o[p])return o[p].exports;var t=o[p]={i:p,l:!1,exports:{}};return g[p].call(t.exports,t,t.exports,e),t.l=!0,t.exports}e.m=g,e.c=o,e.d=function(g,o,p){e.o(g,o)||Object.defineProperty(g,o,{enumerable:!0,get:p})},e.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},e.t=function(g,o){if(1&o&&(g=e(g)),8&o)return g;if(4&o&&"object"==typeof g&&g&&g.__esModule)return g;var p=Object.create(null);if(e.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:g}),2&o&&"string"!=typeof g)for(var t in g)e.d(p,t,function(o){return g[o]}.bind(null,t));return p},e.n=function(g){var o=g&&g.__esModule?function(){return g.default}:function(){return g};return e.d(o,"a",o),o},e.o=function(g,o){return Object.prototype.hasOwnProperty.call(g,o)},e.p="",e(e.s=1)}([,function(g,o,e){window.onerror=function(g,o,e){return alert(g),!1};Vex.Flow;const p=document.getElementById("mystaff"),{Stave:t,StaveNote:m,Beam:n,Formatter:s,Renderer:r,Accidental:a}=Vex.Flow,i={flute:"flute",piano:"piano","lead 1 (square)":"flute","electric bass (finger)":"bass-electric","fretless bass":"bass-electric","synthbrass 2":"french-horn","fx 3 (crystal)":"xylophone","lead 2 (sawtooth)":"flute","overdriven guitar":"guitar-electric","string ensemble 1":"violin","orchestral harp":"harp","acoustic grand piano":"piano","bright acoustic piano":"piano",vibraphone:"piano",trumpet:"trumpet","acoustic guitar (steel)":"guitar-acoustic","electric guitar (clean)":"guitar-electric","soprano sax":"saxophone","tenor sax":"saxophone","pad 2 (warm)":"violin","alto sax":"saxophone","electric guitar (jazz)":"guitar-electric","acoustic bass":"bass-electric","synth bass 1":"bass-electric","drawbar organ":"organ",piccolo:"flute",shamisen:"guitar-acoustic",xylophone:"xylophone","drawbar organ":"organ",shakuhachi:"clarinet","church organ":"organ",cello:"cello",harmonica:"harmonium",trombone:"trombone","muted trumpet":"trumpet",glockenspiel:"xylophone","bag pipe":"flute","pan flute":"flute",recorder:"organ",clarinet:"clarinet",whistle:"saxophone",accordion:"harmonium","string ensemble 2":"violin","slap bass 1":"bass-electric","electric piano 2":"piano",tuba:"tuba",oboe:"clarinet","english horn":"bassoon","french horn":"french-horn",bassoon:"bassoon","synthstrings 1":"violin","pizzicato strings":"harp",contrabass:"contrabass","acoustic guitar (nylon)":"guitar-nylon"},c={"bass-electric":{"A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},"bass-acoustic":{"A#1":"Bb1.[mp3|ogg]","A#2":"Bb2.[mp3|ogg]","A#3":"Bb3.[mp3|ogg]","A#4":"Bb4.[mp3|ogg]","C#1":"Db1.[mp3|ogg]","C#2":"Db2.[mp3|ogg]","C#3":"Db3.[mp3|ogg]","C#4":"Db4.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]"},bassoon:{A4:"A4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",E4:"E4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]"},cello:{E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]"},clarinet:{D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]",D3:"D3.[mp3|ogg]"},contrabass:{C2:"C2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]",D2:"D2.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]",G1:"G1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]",A2:"A2.[mp3|ogg]","A#1":"As1.[mp3|ogg]",B3:"B3.[mp3|ogg]"},flute:{A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]"},"french-horn":{D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F5:"F5.[mp3|ogg]",G2:"G2.[mp3|ogg]",A1:"A1.[mp3|ogg]",A3:"A3.[mp3|ogg]",C2:"C2.[mp3|ogg]",C4:"C4.[mp3|ogg]"},"guitar-acoustic":{F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds3.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]"},"guitar-electric":{"D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]",E2:"E2.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]"},"guitar-nylon":{"F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G3.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#5":"As5.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]"},harmonium:{C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]"},harp:{C5:"C5.[mp3|ogg]",D2:"D2.[mp3|ogg]",D4:"D4.[mp3|ogg]",D6:"D6.[mp3|ogg]",D7:"D7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E3:"E3.[mp3|ogg]",E5:"E5.[mp3|ogg]",F2:"F2.[mp3|ogg]",F4:"F4.[mp3|ogg]",F6:"F6.[mp3|ogg]",F7:"F7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G3:"G3.[mp3|ogg]",G5:"G5.[mp3|ogg]",A2:"A2.[mp3|ogg]",A4:"A4.[mp3|ogg]",A6:"A6.[mp3|ogg]",B1:"B1.[mp3|ogg]",B3:"B3.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C3:"C3.[mp3|ogg]"},organ:{C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]"},piano:{A7:"A7.[mp3|ogg]",A1:"A1.[mp3|ogg]",A2:"A2.[mp3|ogg]",A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]","A#7":"As7.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]","A#5":"As5.[mp3|ogg]","A#6":"As6.[mp3|ogg]",B7:"B7.[mp3|ogg]",B1:"B1.[mp3|ogg]",B2:"B2.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",B5:"B5.[mp3|ogg]",B6:"B6.[mp3|ogg]",C7:"C7.[mp3|ogg]",C1:"C1.[mp3|ogg]",C2:"C2.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]","C#7":"Cs7.[mp3|ogg]","C#1":"Cs1.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]","C#6":"Cs6.[mp3|ogg]",D7:"D7.[mp3|ogg]",D1:"D1.[mp3|ogg]",D2:"D2.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]",D6:"D6.[mp3|ogg]","D#7":"Ds7.[mp3|ogg]","D#1":"Ds1.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","D#6":"Ds6.[mp3|ogg]",E7:"E7.[mp3|ogg]",E1:"E1.[mp3|ogg]",E2:"E2.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",F7:"F7.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",F6:"F6.[mp3|ogg]","F#7":"Fs7.[mp3|ogg]","F#1":"Fs1.[mp3|ogg]","F#2":"Fs2.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]","F#6":"Fs6.[mp3|ogg]",G7:"G7.[mp3|ogg]",G1:"G1.[mp3|ogg]",G2:"G2.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]","G#7":"Gs7.[mp3|ogg]","G#1":"Gs1.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]","G#6":"Gs6.[mp3|ogg]"},saxophone:{"D#5":"Ds5.[mp3|ogg]",E3:"E3.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]","F#3":"Fs3.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",G3:"G3.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","G#4":"Gs4.[mp3|ogg]","G#5":"Gs5.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#3":"As3.[mp3|ogg]","A#4":"As4.[mp3|ogg]",B3:"B3.[mp3|ogg]",B4:"B4.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]","C#3":"Cs3.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]"},trombone:{"A#3":"As3.[mp3|ogg]",C3:"C3.[mp3|ogg]",C4:"C4.[mp3|ogg]","C#2":"Cs2.[mp3|ogg]","C#4":"Cs4.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]","D#3":"Ds3.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]","G#2":"Gs2.[mp3|ogg]","G#3":"Gs3.[mp3|ogg]","A#1":"As1.[mp3|ogg]","A#2":"As2.[mp3|ogg]"},trumpet:{C6:"C6.[mp3|ogg]",D5:"D5.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]",F3:"F3.[mp3|ogg]",F4:"F4.[mp3|ogg]",F5:"F5.[mp3|ogg]",G4:"G4.[mp3|ogg]",A3:"A3.[mp3|ogg]",A5:"A5.[mp3|ogg]","A#4":"As4.[mp3|ogg]",C4:"C4.[mp3|ogg]"},tuba:{"A#2":"As2.[mp3|ogg]","A#3":"As3.[mp3|ogg]",D3:"D3.[mp3|ogg]",D4:"D4.[mp3|ogg]","D#2":"Ds2.[mp3|ogg]",F1:"F1.[mp3|ogg]",F2:"F2.[mp3|ogg]",F3:"F3.[mp3|ogg]","A#1":"As1.[mp3|ogg]"},violin:{A3:"A3.[mp3|ogg]",A4:"A4.[mp3|ogg]",A5:"A5.[mp3|ogg]",A6:"A6.[mp3|ogg]",C4:"C4.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]",E4:"E4.[mp3|ogg]",E5:"E5.[mp3|ogg]",E6:"E6.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]"},xylophone:{C8:"C8.[mp3|ogg]",G4:"G4.[mp3|ogg]",G5:"G5.[mp3|ogg]",G6:"G6.[mp3|ogg]",G7:"G7.[mp3|ogg]",C5:"C5.[mp3|ogg]",C6:"C6.[mp3|ogg]",C7:"C7.[mp3|ogg]"}},l=new Tone.Chorus(4,2.5,.5).toDestination().start();synth1=(new Tone.PolySynth).connect(l);const u=new Tone.Distortion(.8).toDestination();synth2=(new Tone.FMSynth).connect(u),synth3=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();const C=h("name"),A=h("track");let d;d="//cdn.jsdelivr.net/gh/zsyz2008/musicGames/song/"+C+".json",d=d+"?t="+(new Date).getTime();const D=document.getElementById("scoreGroup");let F;function G(g){return new Promise((o,e)=>{let p;p="https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/"+g+"/";const t=new Tone.Sampler({urls:c[g],baseUrl:p,onload:g=>{o(t)}}).toDestination()})}function h(g){for(var o=window.location.search.substring(1).split("&"),e=0;e<o.length;e++){var p=o[e].split("=");if(p[0]==g)return p[1]}return!1}fetch(d).then(g=>{if(200===g.status)return g.json();console.log("Looks like there was a problem. Status Code: "+g.status)}).then((function(g){F=g,document.getElementById("title").textContent=F.header.name;const o=F.header.timeSignatures[0].timeSignature[0],e=(F.header.timeSignatures[0].timeSignature[1],document.getElementById("scorePai"));for(let g=0;g<o;g++){const p=document.createElement("div");p.boxSizing="content-box",p.setAttribute("class","list"),g<o-1&&(p.style.borderRight="1px solid #db5a6b"),p.style.width=100/o+"%",p.textContent=g+1,e.appendChild(p)}return p=F,new Promise((g,o)=>{const e=+p.header.tempos[0].bpm,t=4*+p.header.timeSignatures[0].timeSignature[0]/(+p.header.timeSignatures[0].timeSignature[1]/1)*(60/e),m={};let n=p.tracks;n=n.filter(g=>g.notes.length>0),n=n.filter(g=>"standard kit"!==g.instrument.name&&"jazz kit"!==g.instrument.name&&"brush kit"!==g.instrument.name);const s=n.find(g=>-1!==g.instrument.name.indexOf(" bass"));n=n.filter(g=>-1===g.instrument.name.indexOf(" bass")),s&&n.push(s),"solo"===A&&(n=n.filter((g,o)=>0===o)),"bz"===A&&(n=n.filter((g,o)=>0!==o));const r=[];for(let g of n){const o=g.instrument.name;let e;i[o]?e=G(i[o]):(console.log(o),e=Promise.resolve(synth1)),r.push(e)}Promise.all(r).then(g=>g).then(o=>{n.forEach((g,e)=>{const p=o[e];g.notes.forEach(o=>{const t=o.time;let s,r=m[t];s=0===e?"solo":e===n.length-1&&-1!==g.instrument.name.indexOf(" bass")?"bass":"zt";const a={type:s,name:o.name,duration:o.duration,velocity:+o.velocity*{solo:1,bass:1,zt:.4}[s],synth:p,trackIndex:e};r?r.push(a):m[t]=[a]})});const e=[];let p=[],s=Object.keys(m).sort((function(g,o){return+g-+o}));for(let g of s)e.push(m[g]),p.push(g);const r=Math.ceil(p[p.length-1]/t),a={},i={},c={};for(let g=0;g<r;g++){const o=[];for(let e=0;e<p.length;e++)p[e]<(g+1)*t&&p[e]>=g*t&&(o.push({index:e,duration:p[e+1]-p[e]||1}),c[e]=o[0].index);const e=o[0]||"none";a[e.index]=o,i[e.index]=g}const l=n.length;g({notes:e,times:p,groupMap:a,groupValMap:i,trackLen:l,indexToGroupMap:c})})});var p})).then(g=>{!function(g){const{playBtn:o,scoreContainer:e,mid:n}=g,{notes:i,times:c,groupMap:l,groupValMap:u,indexToGroupMap:C,trackLen:A}=n;let d,F=0,G=-1,h=!1;document.getElementById("control").addEventListener("change",(function(g){h=!!g.target.checked})),e.addEventListener("touchstart",g=>{g.preventDefault()});const f=document.getElementById("staff"),E=document.getElementById("staffDiv");f.addEventListener("change",(function(g){g.target.checked?E.style.visibility="visible":E.style.visibility="hidden"}));const b=document.getElementById("reset");function y(){G++;const g=l[F];if(g){if(1===G)return void(G=0);!function(g){p.innerHTML="";const o=new r(p,r.Backends.SVG),e=document.body.clientWidth;o.resize(e,320);const n=o.getContext(),i=new t(10,50,e-20);i.addClef("treble").setContext(n).draw();const c=[],l=[];for(let o of g){let g=[],e=[],p=[],t=[];for(let m of o){let o=m.name;const n=o.split(""),s=n.shift(),r=n.pop(),a=n[0];+m.name.slice(o.length-1)>3?(g.push(`${s}/${r}`),p.push(a)):(e.push(`${s}/${r}`),t.push(a))}c.push({ups:g,upsAddModifier:p}),l.push({downs:e,downsAddModifier:t})}const u=c.map(g=>{let o;return g.ups.length>0?(o=new m({keys:g.ups,duration:"q"}),g.upsAddModifier.forEach((g,e)=>{g&&(o=o.addModifier(new a(g),e))})):o=new m({keys:["B/4"],duration:"qr"}),o});s.FormatAndDraw(n,i,u);const C=new t(10,150,e-20);C.addClef("bass").setContext(n).draw();const A=l.map(g=>{let o;return g.downs.length>0?(o=new m({keys:g.downs,duration:"q",stem_direction:-1,clef:"bass"}),g.downsAddModifier.forEach((g,e)=>{g&&(o=o.addModifier(new a(g),e))})):o=new m({keys:["D/3"],duration:"qr",stem_direction:-1,clef:"bass"}),o});s.FormatAndDraw(n,C,A)}(g.map(g=>i[g.index])),D.textContent="第"+(+u[F]+1)+"小节",d=[],e.innerHTML="",G=0;const o=g.reduce((g,o)=>g+o.duration,0);for(let p=0;p<g.length;p++){const t=document.createElement("button"),m=g[p];t.setAttribute("class","list button2 fire"),t.style.opacity=.3,t.style.width=100*m.duration/o+"%",0===p&&k(t),e.appendChild(t),d.push(t)}}}if(b&&b.addEventListener("click",()=>{F=C[F-1],G=0,y()}),y(),window.addEventListener("keydown",g=>{S()}),window.addEventListener("keyup",g=>{M()}),!navigator.requestMIDIAccess)return void console.log("当前浏览器不支持 MIDI 连接，请使用 Chrome 等支持 Web MIDI 的浏览器");let B=[];const v=g=>{const o=`${g.note.name}${g.note.accidental?g.note.accidental:""}${g.note.octave}`;B.push(Tone.Frequency(o).toMidi());const e=i[F].map(g=>Tone.Frequency(g.name).toMidi());let p=!0;for(let g of e)B.includes(g)||(p=!1);p&&S()},w=()=>{B=[]};function x(g){g&&g.preventDefault(),S()}function M(){var g;h&&I&&I.forEach(g=>{g.synth.triggerRelease(g.name)}),d&&d[G]&&(g=d[G])&&g.removeEventListener("touchstart",x)}function k(g){g&&(g.style.opacity=1,g.addEventListener("touchstart",x))}var I,T;function S(){console.log(I),h&&I&&I.forEach(g=>{g.synth.triggerRelease(g.name)});i[F+1];const g=i[F];console.log(I,g,23),I=g,g.forEach(g=>{!function(g){h?g.synth.triggerAttack(g.name,Tone.now(),g.velocity):g.synth.triggerAttackRelease(g.name,g.duration,Tone.now(),g.velocity)}(g)}),function(){y(),clearInterval(T);const g=d[G];if(!g)return;const o=c[F],e=c[F+1];let p;p=e?1e3*(e-o):3e3;let t,m=Date.now();T=setInterval(()=>{if(t<100)return clearInterval(T),t=0,g.style.opacity=0,k(d[G+1]),void(G===d.length-1&&(G=-1,y()));t=p-(Date.now()-m);const o=Math.ceil(100*t/p);g.style.opacity=o/100},10)}(),F===i.length-1?F=0:F++,M()}WebMidi.enable(()=>{if(0===WebMidi.inputs.length)return void console.log("没有找到可连接的 MIDI 设备，请检查 MIDI 设备是否正确连接");const g=WebMidi.inputs[0];g.addListener("noteon","all",v),g.addListener("noteoff","all",w)})}({playBtn:document.getElementById("playBtn"),scoreContainer:document.getElementById("scoreContainer"),mid:g})}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);