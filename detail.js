!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([,function(e,t,n){const o=["#e05915","#cdd422","#431c5d","#bccbde","#c2dde6","#431c5d","#3cc47c","#76323f","#cdd422","#431c5d","#bccbde","#c2dde6"],r={flute:"flute",piano:"piano","lead 1 (square)":"flute","electric bass (finger)":"bass-electric","lead 2 (sawtooth)":"flute","overdriven guitar":"guitar-electric","string ensemble 1":"violin","orchestral harp":"piano","acoustic grand piano":"piano",vibraphone:"piano",trumpet:"trumpet","acoustic guitar (steel)":"guitar-acoustic","electric guitar (clean)":"guitar-electric","soprano sax":"saxophone","pad 2 (warm)":"violin","alto sax":"saxophone","electric guitar (jazz)":"guitar-electric","acoustic bass":"bass-electric","synth bass 1":"bass-electric","drawbar organ":"organ",piccolo:"flute",shamisen:"guitar-acoustic",xylophone:"xylophone","drawbar organ":"organ",shakuhachi:"clarinet","church organ":"organ",cello:"cello",harmonica:"harmonium",trombone:"trombone","muted trumpet":"trumpet",glockenspiel:"xylophone","bag pipe":"flute","pan flute":"flute",recorder:"organ",clarinet:"clarinet",whistle:"saxophone",accordion:"harmonium","string ensemble 2":"violin"},s=new Tone.Chorus(4,2.5,.5).toDestination().start();synth1=(new Tone.PolySynth).connect(s);const a=new Tone.Distortion(.8).toDestination();synth2=(new Tone.FMSynth).connect(a),synth3=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();let i;i="//cdn.jsdelivr.net/gh/zsyz2008/musicGames/song/"+function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e)return o[1]}return!1}("name")+".json";const l=document.getElementById("scoreGroup");let c;function u(e){return new Promise((t,n)=>{let o;o="https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/"+e+"/",console.log(o,23);const r=new Tone.Sampler({urls:SampleLibrary[e],baseUrl:"./samples/piano/",onload:e=>{t(r)}}).toDestination()})}fetch(i).then(e=>{if(200===e.status)return e.json();console.log("Looks like there was a problem. Status Code: "+e.status)}).then((function(e){c=e,document.getElementById("title").textContent=c.header.name;const t=c.header.timeSignatures[0].timeSignature[0],n=document.getElementById("scoreTick"),o=document.getElementById("scorePai");for(let e=0;e<t;e++){const r=document.createElement("div");r.setAttribute("class","list"),r.style.zIndex=1,r.style.boxSizing="content-box",r.style.backgroundColor="rgba(0,0,0,0)",r.boxSizing="content-box",e<t-1&&(r.style.borderRight="1px solid #db5a6b"),r.style.width=100/t+"%",n.appendChild(r);const s=document.createElement("div");s.boxSizing="content-box",s.setAttribute("class","list"),s.style.backgroundColor="#fff",e<t-1&&(s.style.borderRight="1px solid #db5a6b"),s.style.width=100/t+"%",s.textContent="第"+(e+1)+"拍",o.appendChild(s)}return s=c,new Promise((e,t)=>{const n=60/+s.header.tempos[0].bpm*+s.header.timeSignatures[0].timeSignature[0],o={};let a=s.tracks;a=a.filter(e=>e.notes.length>0),a=a.filter(e=>"standard kit"!==e.instrument.name);const i=a.find(e=>-1!==e.instrument.name.indexOf("bass"));a=a.filter(e=>-1===e.instrument.name.indexOf("bass")),i&&a.push(i);const l=[];for(let e of a){const t=e.instrument.name;let n;r[t]?n=u(r[t]):(console.log(t),n=Promise.resolve(synth1)),l.push(n)}Promise.all(l).then(e=>e).then(t=>{a.forEach((e,n)=>{const r=t[n];e.notes.forEach(e=>{const t=e.time;let s,i=o[t];s=0===n?"solo":n===a.length-1?"bass":"zt";const l={type:s,name:e.name,duration:e.duration,velocity:{solo:1,bass:.7,zt:.4}[s],synth:r,trackIndex:n};i?i.push(l):o[t]=[l]})});const r=[];let s=[],i=Object.keys(o).sort((function(e,t){return+e-+t}));for(let e of i)r.push(o[e]),s.push(e);const l=Math.ceil(s[s.length-1]/n),c={},u={};for(let e=0;e<l;e++){const t=[];for(let o=0;o<s.length;o++)s[o]<(e+1)*n&&s[o]>=e*n&&t.push({index:o,duration:s[o+1]-s[o]||1});const o=t[0]||"none";c[o.index]=t,u[o.index]=e}const d=a.length;e({notes:r,times:s,groupMap:c,groupValMap:u,trackLen:d})})});var s})).then(e=>{!function(e){const{playBtn:t,scoreContainer:n,mid:r,control:s}=e,{notes:a,times:i,groupMap:c,groupValMap:u,trackLen:d}=r;let p,h=0,f=0;function m(){f++;const e=c[h];if(e){l.textContent="第"+(+u[h]+1)+"小节",p=[],n.innerHTML="",f=0;const t=e.reduce((e,t)=>e+t.duration,0);for(let r=0;r<e.length;r++){const s=document.createElement("div"),i=e[r];s.setAttribute("class","list"),s.style.width=100*i.duration/t+"%";const l=a[i.index];for(let e=0;e<d;e++){const t=document.createElement("div");t.setAttribute("class","avatar");const n=100/d;t.style.height=n+"%",t.style.top=n*e+"%";l[e];const r=l.filter(t=>t.trackIndex===e);0===r.length&&(t.style.backgroundColor="#eee");for(let n=0;n<r.length;n++){r[n];const s=document.createElement("div");s.setAttribute("class","fq"),s.style.height=100/r.length+"%",s.style.backgroundColor=o[e]||"#000",t.appendChild(s)}s.appendChild(t)}n.appendChild(s),p.push(s)}}}function g(){s&&y.forEach(e=>{e.synth.triggerRelease(e.name)})}m(),t.style.visibility="visible",t.addEventListener("touchstart",e=>{v(),e.preventDefault()}),t.addEventListener("touchend",e=>{g()}),t.addEventListener("mousedown",e=>{v(),e.preventDefault()}),t.addEventListener("mouseup",e=>{g()}),window.addEventListener("keydown",e=>{v()}),window.addEventListener("keyup",e=>{g()});let y,b;function v(){g();const e=a[h];y=e,e.forEach(e=>{!function(e){s?e.synth.triggerAttack(e.name,Tone.now(),e.velocity):e.synth.triggerAttackRelease(e.name,e.duration,Tone.now(),e.velocity)}(e)}),function(){if(p&&p[f])for(let e of Array.prototype.slice.call(p[f].children))e.style.width="0%";m(),clearInterval(b);const e=p[f];if(!e)return;const t=i[h],n=i[h+1];let o;o=n?1e3*(n-t):3e3;let r,s=Date.now();b=setInterval(()=>{if(r<=0){a[h];clearInterval(b),r=0;for(let t of Array.prototype.slice.call(e.children))t.style.width="0%";return}r=o-(Date.now()-s);const t=Math.ceil(100*r/o);for(let n of Array.prototype.slice.call(e.children))n.style.width=t+"%"},30)}(),h===a.length-1?h=0:h++}}({playBtn:document.getElementById("playBtn"),scoreContainer:document.getElementById("scoreContainer"),mid:e,control:!1})}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);