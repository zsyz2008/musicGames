!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if("name"==o[0])return o[1]}return!1}();let o;fetch("./song/"+n+".json").then(e=>{200!==e.status?console.log("Looks like there was a problem. Status Code: "+e.status):e.json().then((function(e){o=e,document.getElementById("title").textContent=o.header.name;const t=function(e){const t=60/+e.header.tempos[0].bpm*+e.header.timeSignatures[0].timeSignature[0],n={};let o=e.tracks;o=o.filter(e=>0<e.notes.length);const r={},a={},l=(o.filter(e=>0<e.notes.length).forEach((e,t)=>{e.notes.forEach(e=>{var o=e.time;let l=n[o];l?l.push({solo:0===t,name:e.name,duration:e.duration,velocity:e.velocity}):n[o]=[{solo:0===t,name:e.name,duration:e.duration,velocity:e.velocity}],0===t?r[e.name]=e.name:a[e.name]=e.name})}),[]);let s=[],i=Object.keys(n).sort((function(e,t){return+e-+t}));for(var c of i)l.push(n[c]),s.push(c);const u=Math.ceil(s[s.length-1]/t),d={};for(let e=0;e<u;e++){const n=[];for(let o=0;o<s.length;o++)s[o]<(e+1)*t&&s[o]>=e*t&&n.push({index:o,duration:s[o+1]-s[o]||1,solo:-1!==l[o].findIndex(e=>!0===e.solo)});d[(n[0]||"none").index]=n}return{notes:l,times:s,groupMap:d,soloMap:r,bzMap:a}}(o);var{soloMap:e,bzMap:n}=t;let r,a;var l=new Tone.Chorus(4,2.5,.5).toDestination().start();a=(new Tone.PolySynth).connect(l),r=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();let s={};for(key in e){var i=SampleLibrary.flute;i[key]&&(s[key]=i[key])}let c={};for(key in n){var u=SampleLibrary.piano;u[key]&&(c[key]=u[key])}const d=new Tone.Sampler({urls:s,baseUrl:"https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/flute/",onload:()=>{r=d;const e=new Tone.Sampler({urls:c,baseUrl:"https://soundfont.s3.cn-north-1.jdcloud-oss.com/samples/piano/",onload:()=>{a=e;{const{playBtn:e,scoreContainer:l,mid:s,instrument:i}={playBtn:document.getElementById("playBtn1"),scoreContainer:document.getElementById("scoreContainer1"),mid:t,instrument:{solo:{synth:r,control:!1},bz:{synth:a,control:!1}}},{notes:c,times:u,groupMap:d}=s,f=i.solo.synth,y=i.solo.control,h=i.bz.synth,p=i.bz.control;let m,v,g,b,w=0,k=0;function n(){k++;const e=d[w];if(e){v=[],l.innerHTML="",k=0;var t=e.reduce((e,t)=>e+t.duration,0);for(let o=0;o<e.length;o++){const r=document.createElement("div");var n=e[o];r.setAttribute("class","list"),r.style.width=100*n.duration/t+"%",r.innerHTML='<div class="avatar"></div>',l.appendChild(r),n.solo?r.children[0].style.backgroundColor="#db5a6b":r.children[0].style.backgroundColor="rgba(252, 201,185)",v.push(r)}m=v.length}}function o(){g&&g.forEach(e=>{e.solo?y&&f.triggerRelease(e.name):p&&h.triggerRelease(e.name)})}n(),e.style.visibility="visible",e.addEventListener("touchstart",e=>{{o();const e=c[w];(g=e).forEach(e=>{e.solo?y?f.triggerAttack(e.name,Tone.now(),.9*e.velocity):f.triggerAttackRelease(e.name,e.duration,Tone.now(),.9*e.velocity):p?h.triggerAttack(e.name,Tone.now(),.3*e.velocity):h.triggerAttackRelease(e.name,e.duration,Tone.now(),.3*e.velocity)});{v&&(v[k].children[0].style.width="0%"),n(),clearInterval(b);const e=v[k],t=u[w],o=u[w+1];let r;r=o?1e3*(o-t):3e3;let a,l=Date.now();b=setInterval(()=>{var t;a<=0?(c[w],clearInterval(b),a=0,e.children[0].style.width="0%"):(a=r-(Date.now()-l),t=Math.ceil(100*a/r),e.children[0].style.width=t+"%")},30)}w===c.length-1?w=0:w++}e.preventDefault()}),e.addEventListener("touchend",e=>{o()})}}}).toDestination()}}).toDestination()}))}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);